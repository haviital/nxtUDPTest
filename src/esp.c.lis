C:/Users/Hannu/AppData/Local/Temp/zcc0000531075EC3.asm:
     1                          MODULE esp_c
     2                          LINE 0, "src/esp.c"
src/esp.c:
                                
     1                          ;--------------------------------------------------------
     2                          ; File Created by SDCC : free open source ISO C Compiler
     3                          ; Version 4.4.0 #14648 (MINGW64)
     4                          ;--------------------------------------------------------
     5                          	.zxn
     6                          ; Processed by Z88DK
     7                          ;--------------------------------------------------------
     8                          
     9                          	EXTERN __divschar
    10                          	EXTERN __divschar_callee
    11                          	EXTERN __divsint
    12                          	EXTERN __divsint_callee
    13                          	EXTERN __divslong
    14                          	EXTERN __divslong_callee
    15                          	EXTERN __divslonglong
    16                          	EXTERN __divslonglong_callee
    17                          	EXTERN __divsuchar
    18                          	EXTERN __divsuchar_callee
    19                          	EXTERN __divuchar
    20                          	EXTERN __divuchar_callee
    21                          	EXTERN __divuint
    22                          	EXTERN __divuint_callee
    23                          	EXTERN __divulong
    24                          	EXTERN __divulong_callee
    25                          	EXTERN __divulonglong
    26                          	EXTERN __divulonglong_callee
    27                          	EXTERN __divuschar
    28                          	EXTERN __divuschar_callee
    29                          	EXTERN __modschar
    30                          	EXTERN __modschar_callee
    31                          	EXTERN __modsint
    32                          	EXTERN __modsint_callee
    33                          	EXTERN __modslong
    34                          	EXTERN __modslong_callee
    35                          	EXTERN __modslonglong
    36                          	EXTERN __modslonglong_callee
    37                          	EXTERN __modsuchar
    38                          	EXTERN __modsuchar_callee
    39                          	EXTERN __moduchar
    40                          	EXTERN __moduchar_callee
    41                          	EXTERN __moduint
    42                          	EXTERN __moduint_callee
    43                          	EXTERN __modulong
    44                          	EXTERN __modulong_callee
    45                          	EXTERN __modulonglong
    46                          	EXTERN __modulonglong_callee
    47                          	EXTERN __moduschar
    48                          	EXTERN __moduschar_callee
    49                          	EXTERN __mulint
    50                          	EXTERN __mulint_callee
    51                          	EXTERN __mullong
    52                          	EXTERN __mullong_callee
    53                          	EXTERN __mullonglong
    54                          	EXTERN __mullonglong_callee
    55                          	EXTERN __mulschar
    56                          	EXTERN __mulschar_callee
    57                          	EXTERN __mulsuchar
    58                          	EXTERN __mulsuchar_callee
    59                          	EXTERN __muluchar
    60                          	EXTERN __muluchar_callee
    61                          	EXTERN __muluschar
    62                          	EXTERN __muluschar_callee
    63                          	EXTERN __rlslonglong
    64                          	EXTERN __rlslonglong_callee
    65                          	EXTERN __rlulonglong
    66                          	EXTERN __rlulonglong_callee
    67                          	EXTERN __rrslonglong
    68                          	EXTERN __rrslonglong_callee
    69                          	EXTERN __rrulonglong
    70                          	EXTERN __rrulonglong_callee
    71                          	EXTERN ___mulsint2slong
    72                          	EXTERN ___mulsint2slong_callee
    73                          	EXTERN ___muluint2ulong
    74                          	EXTERN ___muluint2ulong_callee
    75                          	EXTERN ___sdcc_call_hl
    76                          	EXTERN ___sdcc_call_iy
    77                          	EXTERN ___sdcc_enter_ix
    78                          	EXTERN banked_call
    79                          	EXTERN _banked_ret
    80                          	EXTERN ___fs2schar
    81                          	EXTERN ___fs2schar_callee
    82                          	EXTERN ___fs2sint
    83                          	EXTERN ___fs2sint_callee
    84                          	EXTERN ___fs2slong
    85                          	EXTERN ___fs2slong_callee
    86                          	EXTERN ___fs2slonglong
    87                          	EXTERN ___fs2slonglong_callee
    88                          	EXTERN ___fs2uchar
    89                          	EXTERN ___fs2uchar_callee
    90                          	EXTERN ___fs2uint
    91                          	EXTERN ___fs2uint_callee
    92                          	EXTERN ___fs2ulong
    93                          	EXTERN ___fs2ulong_callee
    94                          	EXTERN ___fs2ulonglong
    95                          	EXTERN ___fs2ulonglong_callee
    96                          	EXTERN ___fsadd
    97                          	EXTERN ___fsadd_callee
    98                          	EXTERN ___fsdiv
    99                          	EXTERN ___fsdiv_callee
   100                          	EXTERN ___fseq
   101                          	EXTERN ___fseq_callee
   102                          	EXTERN ___fsgt
   103                          	EXTERN ___fsgt_callee
   104                          	EXTERN ___fslt
   105                          	EXTERN ___fslt_callee
   106                          	EXTERN ___fsmul
   107                          	EXTERN ___fsmul_callee
   108                          	EXTERN ___fsneq
   109                          	EXTERN ___fsneq_callee
   110                          	EXTERN ___fssub
   111                          	EXTERN ___fssub_callee
   112                          	EXTERN ___schar2fs
   113                          	EXTERN ___schar2fs_callee
   114                          	EXTERN ___sint2fs
   115                          	EXTERN ___sint2fs_callee
   116                          	EXTERN ___slong2fs
   117                          	EXTERN ___slong2fs_callee
   118                          	EXTERN ___slonglong2fs
   119                          	EXTERN ___slonglong2fs_callee
   120                          	EXTERN ___uchar2fs
   121                          	EXTERN ___uchar2fs_callee
   122                          	EXTERN ___uint2fs
   123                          	EXTERN ___uint2fs_callee
   124                          	EXTERN ___ulong2fs
   125                          	EXTERN ___ulong2fs_callee
   126                          	EXTERN ___ulonglong2fs
   127                          	EXTERN ___ulonglong2fs_callee
   128                          	EXTERN ____sdcc_2_copy_src_mhl_dst_deix
   129                          	EXTERN ____sdcc_2_copy_src_mhl_dst_bcix
   130                          	EXTERN ____sdcc_4_copy_src_mhl_dst_deix
   131                          	EXTERN ____sdcc_4_copy_src_mhl_dst_bcix
   132                          	EXTERN ____sdcc_4_copy_src_mhl_dst_mbc
   133                          	EXTERN ____sdcc_4_ldi_nosave_bc
   134                          	EXTERN ____sdcc_4_ldi_save_bc
   135                          	EXTERN ____sdcc_4_push_hlix
   136                          	EXTERN ____sdcc_4_push_mhl
   137                          	EXTERN ____sdcc_lib_setmem_hl
   138                          	EXTERN ____sdcc_ll_add_de_bc_hl
   139                          	EXTERN ____sdcc_ll_add_de_bc_hlix
   140                          	EXTERN ____sdcc_ll_add_de_hlix_bc
   141                          	EXTERN ____sdcc_ll_add_de_hlix_bcix
   142                          	EXTERN ____sdcc_ll_add_deix_bc_hl
   143                          	EXTERN ____sdcc_ll_add_deix_hlix
   144                          	EXTERN ____sdcc_ll_add_hlix_bc_deix
   145                          	EXTERN ____sdcc_ll_add_hlix_deix_bc
   146                          	EXTERN ____sdcc_ll_add_hlix_deix_bcix
   147                          	EXTERN ____sdcc_ll_asr_hlix_a
   148                          	EXTERN ____sdcc_ll_asr_mbc_a
   149                          	EXTERN ____sdcc_ll_copy_src_de_dst_hlix
   150                          	EXTERN ____sdcc_ll_copy_src_de_dst_hlsp
   151                          	EXTERN ____sdcc_ll_copy_src_deix_dst_hl
   152                          	EXTERN ____sdcc_ll_copy_src_deix_dst_hlix
   153                          	EXTERN ____sdcc_ll_copy_src_deixm_dst_hlsp
   154                          	EXTERN ____sdcc_ll_copy_src_desp_dst_hlsp
   155                          	EXTERN ____sdcc_ll_copy_src_hl_dst_de
   156                          	EXTERN ____sdcc_ll_copy_src_hlsp_dst_de
   157                          	EXTERN ____sdcc_ll_copy_src_hlsp_dst_deixm
   158                          	EXTERN ____sdcc_ll_lsl_hlix_a
   159                          	EXTERN ____sdcc_ll_lsl_mbc_a
   160                          	EXTERN ____sdcc_ll_lsr_hlix_a
   161                          	EXTERN ____sdcc_ll_lsr_mbc_a
   162                          	EXTERN ____sdcc_ll_push_hlix
   163                          	EXTERN ____sdcc_ll_push_mhl
   164                          	EXTERN ____sdcc_ll_sub_de_bc_hl
   165                          	EXTERN ____sdcc_ll_sub_de_bc_hlix
   166                          	EXTERN ____sdcc_ll_sub_de_hlix_bc
   167                          	EXTERN ____sdcc_ll_sub_de_hlix_bcix
   168                          	EXTERN ____sdcc_ll_sub_deix_bc_hl
   169                          	EXTERN ____sdcc_ll_sub_deix_hlix
   170                          	EXTERN ____sdcc_ll_sub_hlix_bc_deix
   171                          	EXTERN ____sdcc_ll_sub_hlix_deix_bc
   172                          	EXTERN ____sdcc_ll_sub_hlix_deix_bcix
   173                          	EXTERN ____sdcc_load_debc_deix
   174                          	EXTERN ____sdcc_load_dehl_deix
   175                          	EXTERN ____sdcc_load_debc_mhl
   176                          	EXTERN ____sdcc_load_hlde_mhl
   177                          	EXTERN ____sdcc_store_dehl_bcix
   178                          	EXTERN ____sdcc_store_debc_hlix
   179                          	EXTERN ____sdcc_store_debc_mhl
   180                          	EXTERN ____sdcc_cpu_pop_ei
   181                          	EXTERN ____sdcc_cpu_pop_ei_jp
   182                          	EXTERN ____sdcc_cpu_push_di
   183                          	EXTERN ____sdcc_outi
   184                          	EXTERN ____sdcc_outi_128
   185                          	EXTERN ____sdcc_outi_256
   186                          	EXTERN ____sdcc_ldi
   187                          	EXTERN ____sdcc_ldi_128
   188                          	EXTERN ____sdcc_ldi_256
   189                          	EXTERN ____sdcc_4_copy_srcd_hlix_dst_deix
   190                          	EXTERN ____sdcc_4_and_src_mbc_mhl_dst_deix
   191                          	EXTERN ____sdcc_4_or_src_mbc_mhl_dst_deix
   192                          	EXTERN ____sdcc_4_xor_src_mbc_mhl_dst_deix
   193                          	EXTERN ____sdcc_4_or_src_dehl_dst_bcix
   194                          	EXTERN ____sdcc_4_xor_src_dehl_dst_bcix
   195                          	EXTERN ____sdcc_4_and_src_dehl_dst_bcix
   196                          	EXTERN ____sdcc_4_xor_src_mbc_mhl_dst_debc
   197                          	EXTERN ____sdcc_4_or_src_mbc_mhl_dst_debc
   198                          	EXTERN ____sdcc_4_and_src_mbc_mhl_dst_debc
   199                          	EXTERN ____sdcc_4_cpl_src_mhl_dst_debc
   200                          	EXTERN ____sdcc_4_xor_src_debc_mhl_dst_debc
   201                          	EXTERN ____sdcc_4_or_src_debc_mhl_dst_debc
   202                          	EXTERN ____sdcc_4_and_src_debc_mhl_dst_debc
   203                          	EXTERN ____sdcc_4_and_src_debc_hlix_dst_debc
   204                          	EXTERN ____sdcc_4_or_src_debc_hlix_dst_debc
   205                          	EXTERN ____sdcc_4_xor_src_debc_hlix_dst_debc
   206                          
   207                          ;--------------------------------------------------------
   208                          ; Public variables in this module
   209                          ;--------------------------------------------------------
   210                          	GLOBAL _esp_finetune_bps
   211                          	GLOBAL _esp_bps_query
   212                          	GLOBAL _esp_binary_search_bps
   213                          	GLOBAL _esp_bsearch
   214                          	GLOBAL _common_bps_range
   215                          	GLOBAL _common_bps
   216                          	GLOBAL _STRING_ESP_RX_OK
   217                          	GLOBAL _STRING_ESP_RX_AT_BPS_R2
   218                          	GLOBAL _STRING_ESP_TX_AT_BPS_Q2
   219                          	GLOBAL _STRING_ESP_RX_AT_BPS_R1
   220                          	GLOBAL _STRING_ESP_TX_AT_BPS_Q1
   221                          	GLOBAL _STRING_ESP_TX_AT_GMR
   222                          	GLOBAL _STRING_ESP_TX_AT
   223                          	GLOBAL _esp_prescaler_endpoint
   224                          	GLOBAL _esp_prescaler
   225                          	GLOBAL _buffer
   226                          	GLOBAL _esp_response_time_ms
   227                          	GLOBAL _esp_bps
   228                          	GLOBAL _esp_response_ok
   229                          	GLOBAL _esp_test
   230                          	GLOBAL _esp_detect_bps
   231                          ;--------------------------------------------------------
   232                          ; Externals used
   233                          ;--------------------------------------------------------
   234                          	GLOBAL _atoi
   235                          	GLOBAL _itoa
   236                          	GLOBAL _uart_get_received_data
   237                          	GLOBAL _uart_read_response
   238                          	GLOBAL _uart_send_data_packet
   239                          	GLOBAL _uart_available_rx
   240                          	GLOBAL _uart_send_raw_data_and_print
   241                          	GLOBAL _uart_raw_data_tx
   242                          	GLOBAL _uart_rx_readline_last
   243                          	GLOBAL _uart_rx_readline
   244                          	GLOBAL _uart_tx
   245                          	GLOBAL _uart_set_prescaler
   246                          	GLOBAL _uart_compute_prescaler
   247                          	GLOBAL _uart_send_at_cmd_custom_response
   248                          	GLOBAL _uart_send_at_cmd
   249                          	GLOBAL _DrawStatusTextAndPageFlip
   250                          	GLOBAL _UpdateAndDrawAll
   251                          	GLOBAL _layer2_blit_off_screen_sub_column
   252                          	GLOBAL _layer2_blit_off_screen_column
   253                          	GLOBAL _layer2_blit_off_screen_sub_row
   254                          	GLOBAL _layer2_blit_transparent
   255                          	GLOBAL _layer2_blit
   256                          	GLOBAL _layer2_fill_rect
   257                          	GLOBAL _layer2_set_font
   258                          	GLOBAL _layer2_draw_text
   259                          	GLOBAL _layer2_draw_rect
   260                          	GLOBAL _layer2_draw_line
   261                          	GLOBAL _layer2_draw_pixel
   262                          	GLOBAL _layer2_copy_off_screen
   263                          	GLOBAL _layer2_load_palette
   264                          	GLOBAL _layer2_load_screen
   265                          	GLOBAL _layer2_clear_screen
   266                          	GLOBAL _layer2_get_offset_y
   267                          	GLOBAL _layer2_set_offset_y
   268                          	GLOBAL _layer2_get_offset_x
   269                          	GLOBAL _layer2_set_offset_x
   270                          	GLOBAL _layer2_reset_palette
   271                          	GLOBAL _layer2_set_palette
   272                          	GLOBAL _layer2_set_rw_palette
   273                          	GLOBAL _layer2_set_display_palette
   274                          	GLOBAL _layer2_get_global_transparency_color
   275                          	GLOBAL _layer2_set_global_transparency_color
   276                          	GLOBAL _layer2_flip_main_shadow_screen
   277                          	GLOBAL _layer2_get_shadow_screen_ram_bank
   278                          	GLOBAL _layer2_set_shadow_screen_ram_bank
   279                          	GLOBAL _layer2_get_main_screen_ram_bank
   280                          	GLOBAL _layer2_set_main_screen_ram_bank
   281                          	GLOBAL _layer2_set_layer_priorities
   282                          	GLOBAL _layer2_configure
   283                          	GLOBAL _ffsll_callee
   284                          	GLOBAL _ffsll
   285                          	GLOBAL _strxfrm_callee
   286                          	GLOBAL _strxfrm
   287                          	GLOBAL _strupr_fastcall
   288                          	GLOBAL _strupr
   289                          	GLOBAL _strtok_r_callee
   290                          	GLOBAL _strtok_r
   291                          	GLOBAL _strtok_callee
   292                          	GLOBAL _strtok
   293                          	GLOBAL _strstrip_fastcall
   294                          	GLOBAL _strstrip
   295                          	GLOBAL _strstr_callee
   296                          	GLOBAL _strstr
   297                          	GLOBAL _strspn_callee
   298                          	GLOBAL _strspn
   299                          	GLOBAL _strsep_callee
   300                          	GLOBAL _strsep
   301                          	GLOBAL _strrstrip_fastcall
   302                          	GLOBAL _strrstrip
   303                          	GLOBAL _strrstr_callee
   304                          	GLOBAL _strrstr
   305                          	GLOBAL _strrspn_callee
   306                          	GLOBAL _strrspn
   307                          	GLOBAL _strrev_fastcall
   308                          	GLOBAL _strrev
   309                          	GLOBAL _strrcspn_callee
   310                          	GLOBAL _strrcspn
   311                          	GLOBAL _strrchr_callee
   312                          	GLOBAL _strrchr
   313                          	GLOBAL _strpbrk_callee
   314                          	GLOBAL _strpbrk
   315                          	GLOBAL _strnlen_callee
   316                          	GLOBAL _strnlen
   317                          	GLOBAL _strnicmp_callee
   318                          	GLOBAL _strnicmp
   319                          	GLOBAL _strndup_callee
   320                          	GLOBAL _strndup
   321                          	GLOBAL _strncpy_callee
   322                          	GLOBAL _strncpy
   323                          	GLOBAL _strncmp_callee
   324                          	GLOBAL _strncmp
   325                          	GLOBAL _strnchr_callee
   326                          	GLOBAL _strnchr
   327                          	GLOBAL _strncat_callee
   328                          	GLOBAL _strncat
   329                          	GLOBAL _strncasecmp_callee
   330                          	GLOBAL _strncasecmp
   331                          	GLOBAL _strlwr_fastcall
   332                          	GLOBAL _strlwr
   333                          	GLOBAL _strlen_fastcall
   334                          	GLOBAL _strlen
   335                          	GLOBAL _strlcpy_callee
   336                          	GLOBAL _strlcpy
   337                          	GLOBAL _strlcat_callee
   338                          	GLOBAL _strlcat
   339                          	GLOBAL _stricmp_callee
   340                          	GLOBAL _stricmp
   341                          	GLOBAL _strerror_fastcall
   342                          	GLOBAL _strerror
   343                          	GLOBAL _strdup_fastcall
   344                          	GLOBAL _strdup
   345                          	GLOBAL _strcspn_callee
   346                          	GLOBAL _strcspn
   347                          	GLOBAL _strcpy_callee
   348                          	GLOBAL _strcpy
   349                          	GLOBAL _strcoll_callee
   350                          	GLOBAL _strcoll
   351                          	GLOBAL _strcmp_callee
   352                          	GLOBAL _strcmp
   353                          	GLOBAL _strchrnul_callee
   354                          	GLOBAL _strchrnul
   355                          	GLOBAL _strchr_callee
   356                          	GLOBAL _strchr
   357                          	GLOBAL _strcat_callee
   358                          	GLOBAL _strcat
   359                          	GLOBAL _strcasecmp_callee
   360                          	GLOBAL _strcasecmp
   361                          	GLOBAL _stpncpy_callee
   362                          	GLOBAL _stpncpy
   363                          	GLOBAL _stpcpy_callee
   364                          	GLOBAL _stpcpy
   365                          	GLOBAL _memswap_callee
   366                          	GLOBAL _memswap
   367                          	GLOBAL _memset_wr_callee
   368                          	GLOBAL _memset_wr
   369                          	GLOBAL _memset_callee
   370                          	GLOBAL _memset
   371                          	GLOBAL _memrchr_callee
   372                          	GLOBAL _memrchr
   373                          	GLOBAL _memmove_callee
   374                          	GLOBAL _memmove
   375                          	GLOBAL _memmem_callee
   376                          	GLOBAL _memmem
   377                          	GLOBAL _memcpy_callee
   378                          	GLOBAL _memcpy
   379                          	GLOBAL _memcmp_callee
   380                          	GLOBAL _memcmp
   381                          	GLOBAL _memchr_callee
   382                          	GLOBAL _memchr
   383                          	GLOBAL _memccpy_callee
   384                          	GLOBAL _memccpy
   385                          	GLOBAL _ffsl_fastcall
   386                          	GLOBAL _ffsl
   387                          	GLOBAL _ffs_fastcall
   388                          	GLOBAL _ffs
   389                          	GLOBAL __strrstrip__fastcall
   390                          	GLOBAL __strrstrip_
   391                          	GLOBAL __memupr__callee
   392                          	GLOBAL __memupr_
   393                          	GLOBAL __memstrcpy__callee
   394                          	GLOBAL __memstrcpy_
   395                          	GLOBAL __memlwr__callee
   396                          	GLOBAL __memlwr_
   397                          	GLOBAL _rawmemchr_callee
   398                          	GLOBAL _rawmemchr
   399                          	GLOBAL _strnset_callee
   400                          	GLOBAL _strnset
   401                          	GLOBAL _strset_callee
   402                          	GLOBAL _strset
   403                          	GLOBAL _rindex_callee
   404                          	GLOBAL _rindex
   405                          	GLOBAL _index_callee
   406                          	GLOBAL _index
   407                          	GLOBAL _bzero_callee
   408                          	GLOBAL _bzero
   409                          	GLOBAL _bcopy_callee
   410                          	GLOBAL _bcopy
   411                          	GLOBAL _bcmp_callee
   412                          	GLOBAL _bcmp
   413                          	GLOBAL _tmpnam_ex_fastcall
   414                          	GLOBAL _tmpnam_ex
   415                          	GLOBAL _tmpnam_fastcall
   416                          	GLOBAL _tmpnam
   417                          	GLOBAL _vscanf_unlocked_callee
   418                          	GLOBAL _vscanf_unlocked
   419                          	GLOBAL _vprintf_unlocked_callee
   420                          	GLOBAL _vprintf_unlocked
   421                          	GLOBAL _vfscanf_unlocked_callee
   422                          	GLOBAL _vfscanf_unlocked
   423                          	GLOBAL _vfprintf_unlocked_callee
   424                          	GLOBAL _vfprintf_unlocked
   425                          	GLOBAL _ungetc_unlocked_callee
   426                          	GLOBAL _ungetc_unlocked
   427                          	GLOBAL _scanf_unlocked
   428                          	GLOBAL _rewind_unlocked_fastcall
   429                          	GLOBAL _rewind_unlocked
   430                          	GLOBAL _puts_unlocked_fastcall
   431                          	GLOBAL _puts_unlocked
   432                          	GLOBAL _putchar_unlocked_fastcall
   433                          	GLOBAL _putchar_unlocked
   434                          	GLOBAL _putc_unlocked_callee
   435                          	GLOBAL _putc_unlocked
   436                          	GLOBAL _printf_unlocked
   437                          	GLOBAL _gets_unlocked_fastcall
   438                          	GLOBAL _gets_unlocked
   439                          	GLOBAL _getline_unlocked_callee
   440                          	GLOBAL _getline_unlocked
   441                          	GLOBAL _getdelim_unlocked_callee
   442                          	GLOBAL _getdelim_unlocked
   443                          	GLOBAL _getchar_unlocked
   444                          	GLOBAL _getc_unlocked_fastcall
   445                          	GLOBAL _getc_unlocked
   446                          	GLOBAL _fwrite_unlocked_callee
   447                          	GLOBAL _fwrite_unlocked
   448                          	GLOBAL _ftell_unlocked_fastcall
   449                          	GLOBAL _ftell_unlocked
   450                          	GLOBAL _fsetpos_unlocked_callee
   451                          	GLOBAL _fsetpos_unlocked
   452                          	GLOBAL _fseek_unlocked_callee
   453                          	GLOBAL _fseek_unlocked
   454                          	GLOBAL _fscanf_unlocked
   455                          	GLOBAL _freopen_unlocked_callee
   456                          	GLOBAL _freopen_unlocked
   457                          	GLOBAL _fread_unlocked_callee
   458                          	GLOBAL _fread_unlocked
   459                          	GLOBAL _fputs_unlocked_callee
   460                          	GLOBAL _fputs_unlocked
   461                          	GLOBAL _fputc_unlocked_callee
   462                          	GLOBAL _fputc_unlocked
   463                          	GLOBAL _fprintf_unlocked
   464                          	GLOBAL _fileno_unlocked_fastcall
   465                          	GLOBAL _fileno_unlocked
   466                          	GLOBAL _fgets_unlocked_callee
   467                          	GLOBAL _fgets_unlocked
   468                          	GLOBAL _fgetpos_unlocked_callee
   469                          	GLOBAL _fgetpos_unlocked
   470                          	GLOBAL _fgetc_unlocked_fastcall
   471                          	GLOBAL _fgetc_unlocked
   472                          	GLOBAL _fflush_unlocked_fastcall
   473                          	GLOBAL _fflush_unlocked
   474                          	GLOBAL _ferror_unlocked_fastcall
   475                          	GLOBAL _ferror_unlocked
   476                          	GLOBAL _feof_unlocked_fastcall
   477                          	GLOBAL _feof_unlocked
   478                          	GLOBAL _fclose_unlocked_fastcall
   479                          	GLOBAL _fclose_unlocked
   480                          	GLOBAL _clearerr_unlocked_fastcall
   481                          	GLOBAL _clearerr_unlocked
   482                          	GLOBAL _vsscanf_callee
   483                          	GLOBAL _vsscanf
   484                          	GLOBAL _vsprintf_callee
   485                          	GLOBAL _vsprintf
   486                          	GLOBAL _vsnprintf_callee
   487                          	GLOBAL _vsnprintf
   488                          	GLOBAL _vscanf_callee
   489                          	GLOBAL _vscanf
   490                          	GLOBAL _vprintf_callee
   491                          	GLOBAL _vprintf
   492                          	GLOBAL _vfscanf_callee
   493                          	GLOBAL _vfscanf
   494                          	GLOBAL _vfprintf_callee
   495                          	GLOBAL _vfprintf
   496                          	GLOBAL _vasprintf_callee
   497                          	GLOBAL _vasprintf
   498                          	GLOBAL _ungetc_callee
   499                          	GLOBAL _ungetc
   500                          	GLOBAL _sscanf
   501                          	GLOBAL _sprintf
   502                          	GLOBAL _snprintf
   503                          	GLOBAL _scanf
   504                          	GLOBAL _rewind_fastcall
   505                          	GLOBAL _rewind
   506                          	GLOBAL _puts_fastcall
   507                          	GLOBAL _puts
   508                          	GLOBAL _putchar_fastcall
   509                          	GLOBAL _putchar
   510                          	GLOBAL _putc_callee
   511                          	GLOBAL _putc
   512                          	GLOBAL _printf
   513                          	GLOBAL _perror_fastcall
   514                          	GLOBAL _perror
   515                          	GLOBAL _open_memstream_callee
   516                          	GLOBAL _open_memstream
   517                          	GLOBAL _obstack_vprintf_callee
   518                          	GLOBAL _obstack_vprintf
   519                          	GLOBAL _obstack_printf
   520                          	GLOBAL _gets_fastcall
   521                          	GLOBAL _gets
   522                          	GLOBAL _getline_callee
   523                          	GLOBAL _getline
   524                          	GLOBAL _getdelim_callee
   525                          	GLOBAL _getdelim
   526                          	GLOBAL _getchar
   527                          	GLOBAL _getc_fastcall
   528                          	GLOBAL _getc
   529                          	GLOBAL _fwrite_callee
   530                          	GLOBAL _fwrite
   531                          	GLOBAL _funlockfile_fastcall
   532                          	GLOBAL _funlockfile
   533                          	GLOBAL _ftrylockfile_fastcall
   534                          	GLOBAL _ftrylockfile
   535                          	GLOBAL _ftell_fastcall
   536                          	GLOBAL _ftell
   537                          	GLOBAL _fsetpos_callee
   538                          	GLOBAL _fsetpos
   539                          	GLOBAL _fseek_callee
   540                          	GLOBAL _fseek
   541                          	GLOBAL _fscanf
   542                          	GLOBAL _freopen_callee
   543                          	GLOBAL _freopen
   544                          	GLOBAL _fread_callee
   545                          	GLOBAL _fread
   546                          	GLOBAL _fputs_callee
   547                          	GLOBAL _fputs
   548                          	GLOBAL _fputc_callee
   549                          	GLOBAL _fputc
   550                          	GLOBAL _fprintf
   551                          	GLOBAL _fopen_callee
   552                          	GLOBAL _fopen
   553                          	GLOBAL _fmemopen_callee
   554                          	GLOBAL _fmemopen
   555                          	GLOBAL _flockfile_fastcall
   556                          	GLOBAL _flockfile
   557                          	GLOBAL _fileno_fastcall
   558                          	GLOBAL _fileno
   559                          	GLOBAL _fgets_callee
   560                          	GLOBAL _fgets
   561                          	GLOBAL _fgetpos_callee
   562                          	GLOBAL _fgetpos
   563                          	GLOBAL _fgetc_fastcall
   564                          	GLOBAL _fgetc
   565                          	GLOBAL _fflush_fastcall
   566                          	GLOBAL _fflush
   567                          	GLOBAL _ferror_fastcall
   568                          	GLOBAL _ferror
   569                          	GLOBAL _feof_fastcall
   570                          	GLOBAL _feof
   571                          	GLOBAL _fdopen_callee
   572                          	GLOBAL _fdopen
   573                          	GLOBAL _fclose_fastcall
   574                          	GLOBAL _fclose
   575                          	GLOBAL _clearerr_fastcall
   576                          	GLOBAL _clearerr
   577                          	GLOBAL _asprintf
   578                          	GLOBAL __fmemopen__callee
   579                          	GLOBAL __fmemopen_
   580                          	GLOBAL _stderr
   581                          	GLOBAL _stdout
   582                          	GLOBAL _stdin
   583                          	GLOBAL __MAX_FOPEN
   584                          ;--------------------------------------------------------
   585                          ; special function registers
   586                          ;--------------------------------------------------------
   587                          defc _IO_153B	=	0x153b
   588                          ;--------------------------------------------------------
   589                          ; ram data
   590                          ;--------------------------------------------------------
   591                          	SECTION bss_compiler
   592                          _esp_bps:
   593  0000  00000000          	DEFS 4
   594                          _esp_response_time_ms:
   595  0004  0000              	DEFS 2
   596                          _buffer:
   597  0006  0000000000000000  	DEFS 256
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
   598                          _esp_prescaler:
   599  0106  00000000          	DEFS 4
   600                          _esp_prescaler_endpoint:
   601  010a  00000000          	DEFS 4
   602                          _esp_bsearch_ok_10000_353:
   603  010e  00000000          	DEFS 4
   604                          _esp_bsearch_last_10000_353:
   605  0112  00000000          	DEFS 4
   606                          _esp_binary_search_bps_uart_prescaler_lo_10000_358:
   607  0116  00000000          	DEFS 4
   608                          _esp_binary_search_bps_uart_prescaler_hi_10000_358:
   609  011a  00000000          	DEFS 4
   610                          _esp_bps_query_temp_10000_360:
   611  011e  00000000          	DEFS 4
   612                          _esp_finetune_bps_temp_10000_364:
   613  0122  00000000          	DEFS 4
   614                          _esp_detect_bps_i_10000_370:
   615  0126  00                	DEFS 1
   616                          ;--------------------------------------------------------
   617                          ; ram data
   618                          ;--------------------------------------------------------
   619                          
   620                          IF 0
   621                          
   622                          ; .area _INITIALIZED removed by z88dk
   623                          
   624                          _STRING_ESP_TX_AT:
   625                          	DEFS 5
   626                          _STRING_ESP_TX_AT_GMR:
   627                          	DEFS 9
   628                          _STRING_ESP_TX_AT_BPS_Q1:
   629                          	DEFS 15
   630                          _STRING_ESP_RX_AT_BPS_R1:
   631                          	DEFS 14
   632                          _STRING_ESP_TX_AT_BPS_Q2:
   633                          	DEFS 11
   634                          _STRING_ESP_RX_AT_BPS_R2:
   635                          	DEFS 10
   636                          _STRING_ESP_RX_OK:
   637                          	DEFS 5
   638                          _common_bps:
   639                          	DEFS 36
   640                          _common_bps_range:
   641                          	DEFS 32
   642                          
   643                          ENDIF
   644                          
   645                          ;--------------------------------------------------------
   646                          ; absolute external ram data
   647                          ;--------------------------------------------------------
   648                          	SECTION IGNORE
   649                          ;--------------------------------------------------------
   650                          ; global & static initialisations
   651                          ;--------------------------------------------------------
   652                          	SECTION code_crt_init
   653                          ;--------------------------------------------------------
   654                          ; Home
   655                          ;--------------------------------------------------------
   656                          	SECTION IGNORE
   657                          ;--------------------------------------------------------
   658                          ; code
   659                          ;--------------------------------------------------------
   660                          	SECTION code_compiler
   661                          ;	---------------------------------
   662                          ; Function esp_response_ok
   663                          ; ---------------------------------
   664                          _esp_response_ok:
   665  0000  21ff00            	ld	hl,0x00ff
   666  0003  e5                	push	hl
   667  0004  210600            	ld	hl,_buffer
   668  0007  e5                	push	hl
   669  0008  cd0000            	call	_uart_rx_readline_last
   670  000b  f1                	pop	af
   671  000c  f1                	pop	af
   672  000d  7d                	ld	a,l
   673  000e  b7                	or	a, a
   674  000f  c0                	ret	NZ
   675  0010  014000            	ld	bc,_STRING_ESP_RX_OK
   676  0013  c5                	push	bc
   677  0014  210600            	ld	hl,_buffer
   678  0017  e5                	push	hl
   679  0018  cd0000            	call	_strcmp_callee
   680  001b  7c                	ld	a, h
   681  001c  b5                	or	a, l
   682  001d  d601              	sub	a,0x01
   683  001f  3e00              	ld	a,0x00
   684  0021  17                	rla
   685  0022  6f                	ld	l, a
   686  0023  c9                	ret
   687                          ;	---------------------------------
   688                          ; Function esp_bsearch
   689                          ; ---------------------------------
   690                          _esp_bsearch:
   691  0024  dde5              	push	ix
   692  0026  dd210000          	ld	ix,0
   693  002a  dd39              	add	ix,sp
   694  002c  f5                	push	af
   695  002d  f5                	push	af
   696  002e  210601            	ld	hl,_esp_prescaler
   697  0031  eb                	ex	de,hl
   698  0032  210e01            	ld	hl,_esp_bsearch_ok_10000_353
   699  0035  1a                	ld	a, (de)
   700  0036  77                	ld	(hl), a
   701  0037  23                	inc	hl
   702  0038  13                	inc	de
   703  0039  1a                	ld	a, (de)
   704  003a  77                	ld	(hl), a
   705  003b  23                	inc	hl
   706  003c  13                	inc	de
   707  003d  1a                	ld	a, (de)
   708  003e  77                	ld	(hl), a
   709  003f  23                	inc	hl
   710  0040  13                	inc	de
   711  0041  1a                	ld	a, (de)
   712  0042  77                	ld	(hl), a
   713  0043  3a0e01            	ld	a,(_esp_bsearch_ok_10000_353)
   714  0046  210a01            	ld	hl,_esp_prescaler_endpoint
   715  0049  86                	add	a, (hl)
   716  004a  4f                	ld	c, a
   717  004b  3a0f01            	ld	a,(_esp_bsearch_ok_10000_353 + 1)
   718  004e  210b01            	ld	hl,_esp_prescaler_endpoint + 1
   719  0051  8e                	adc	a, (hl)
   720  0052  47                	ld	b, a
   721  0053  3a1001            	ld	a,(_esp_bsearch_ok_10000_353 + 2)
   722  0056  210c01            	ld	hl,_esp_prescaler_endpoint + 2
   723  0059  8e                	adc	a, (hl)
   724  005a  5f                	ld	e, a
   725  005b  3a1101            	ld	a,(_esp_bsearch_ok_10000_353 + 3)
   726  005e  210d01            	ld	hl,_esp_prescaler_endpoint + 3
   727  0061  8e                	adc	a, (hl)
   728  0062  57                	ld	d, a
   729  0063  cb3a              	srl	d
   730  0065  cb1b              	rr	e
   731  0067  cb18              	rr	b
   732  0069  cb19              	rr	c
   733                          l_esp_bsearch_00104:
   734  006b  c5                	push	bc
   735  006c  d5                	push	de
   736  006d  d5                	push	de
   737  006e  c5                	push	bc
   738  006f  cd0000            	call	_uart_set_prescaler
   739  0072  f1                	pop	af
   740  0073  f1                	pop	af
   741  0074  d1                	pop	de
   742  0075  c1                	pop	bc
   743  0076  c5                	push	bc
   744  0077  d5                	push	de
   745  0078  d5                	push	de
   746  0079  c5                	push	bc
   747  007a  cd0000            	call	_uart_compute_prescaler
   748  007d  f1                	pop	af
   749  007e  f1                	pop	af
   750  007f  dd75fc            	ld	(ix-4),l
   751  0082  dd74fd            	ld	(ix-3),h
   752  0085  dd73fe            	ld	(ix-2),e
   753  0088  dd72ff            	ld	(ix-1),d
   754  008b  d1                	pop	de
   755  008c  c1                	pop	bc
   756  008d  dd7efc            	ld	a,(ix-4)
   757  0090  210000            	ld	hl,_esp_bps
   758  0093  77                	ld	(hl), a
   759  0094  dd7efd            	ld	a,(ix-3)
   760  0097  23                	inc	hl
   761  0098  77                	ld	(hl), a
   762  0099  dd7efe            	ld	a,(ix-2)
   763  009c  23                	inc	hl
   764  009d  77                	ld	(hl), a
   765  009e  dd7eff            	ld	a,(ix-1)
   766  00a1  23                	inc	hl
   767  00a2  77                	ld	(hl), a
   768  00a3  c5                	push	bc
   769  00a4  d5                	push	de
   770  00a5  cda402            	call	_esp_test
   771  00a8  d1                	pop	de
   772  00a9  c1                	pop	bc
   773  00aa  2d                	dec	l
   774  00ab  200c              	jr	NZ,l_esp_bsearch_00102
   775  00ad  210e01            	ld	hl,_esp_bsearch_ok_10000_353
   776  00b0  71                	ld	(hl), c
   777  00b1  23                	inc	hl
   778  00b2  70                	ld	(hl), b
   779  00b3  23                	inc	hl
   780  00b4  73                	ld	(hl), e
   781  00b5  23                	inc	hl
   782  00b6  72                	ld	(hl), d
   783  00b7  180a              	jr	l_esp_bsearch_00103
   784                          l_esp_bsearch_00102:
   785  00b9  210a01            	ld	hl,_esp_prescaler_endpoint
   786  00bc  71                	ld	(hl), c
   787  00bd  23                	inc	hl
   788  00be  70                	ld	(hl), b
   789  00bf  23                	inc	hl
   790  00c0  73                	ld	(hl), e
   791  00c1  23                	inc	hl
   792  00c2  72                	ld	(hl), d
   793                          l_esp_bsearch_00103:
   794  00c3  211201            	ld	hl,_esp_bsearch_last_10000_353
   795  00c6  71                	ld	(hl), c
   796  00c7  23                	inc	hl
   797  00c8  70                	ld	(hl), b
   798  00c9  23                	inc	hl
   799  00ca  73                	ld	(hl), e
   800  00cb  23                	inc	hl
   801  00cc  72                	ld	(hl), d
   802  00cd  3a0e01            	ld	a,(_esp_bsearch_ok_10000_353)
   803  00d0  210a01            	ld	hl,_esp_prescaler_endpoint
   804  00d3  86                	add	a, (hl)
   805  00d4  4f                	ld	c, a
   806  00d5  3a0f01            	ld	a,(_esp_bsearch_ok_10000_353 + 1)
   807  00d8  210b01            	ld	hl,_esp_prescaler_endpoint + 1
   808  00db  8e                	adc	a, (hl)
   809  00dc  47                	ld	b, a
   810  00dd  3a1001            	ld	a,(_esp_bsearch_ok_10000_353 + 2)
   811  00e0  210c01            	ld	hl,_esp_prescaler_endpoint + 2
   812  00e3  8e                	adc	a, (hl)
   813  00e4  5f                	ld	e, a
   814  00e5  3a1101            	ld	a,(_esp_bsearch_ok_10000_353 + 3)
   815  00e8  210d01            	ld	hl,_esp_prescaler_endpoint + 3
   816  00eb  8e                	adc	a, (hl)
   817  00ec  57                	ld	d, a
   818  00ed  cb3a              	srl	d
   819  00ef  cb1b              	rr	e
   820  00f1  cb18              	rr	b
   821  00f3  cb19              	rr	c
   822  00f5  211201            	ld	hl,_esp_bsearch_last_10000_353
   823  00f8  7e                	ld	a, (hl)
   824  00f9  91                	sub	a, c
   825  00fa  c26b00            	jp	NZ,l_esp_bsearch_00104
   826  00fd  23                	inc	hl
   827  00fe  7e                	ld	a, (hl)
   828  00ff  90                	sub	a, b
   829  0100  c26b00            	jp	NZ,l_esp_bsearch_00104
   830  0103  2a1401            	ld	hl, (_esp_bsearch_last_10000_353 + 2)
   831  0106  bf                	cp	a, a
   832  0107  ed52              	sbc	hl, de
   833  0109  c26b00            	jp	NZ,l_esp_bsearch_00104
   834  010c  2a0e01            	ld	hl, (_esp_bsearch_ok_10000_353)
   835  010f  ed5b1001          	ld	de, (_esp_bsearch_ok_10000_353 + 2)
   836  0113  ddf9              	ld	sp, ix
   837  0115  dde1              	pop	ix
   838  0117  c9                	ret
   839                          ;	---------------------------------
   840                          ; Function esp_binary_search_bps
   841                          ; ---------------------------------
   842                          _esp_binary_search_bps:
   843  0118  2a0200            	ld	hl, (_esp_bps + 2)
   844  011b  e5                	push	hl
   845  011c  2a0000            	ld	hl, (_esp_bps)
   846  011f  e5                	push	hl
   847  0120  cd0000            	call	_uart_compute_prescaler
   848  0123  f1                	pop	af
   849  0124  f1                	pop	af
   850  0125  eb                	ex	de, hl
   851  0126  ed530601          	ld	(_esp_prescaler), de
   852  012a  220801            	ld	(_esp_prescaler + 2), hl
   853  012d  210000            	ld	hl,___str_0
   854  0130  e5                	push	hl
   855  0131  cd0000            	call	_printf
   856  0134  f1                	pop	af
   857  0135  210601            	ld	hl,_esp_prescaler
   858  0138  4e                	ld	c, (hl)
   859  0139  23                	inc	hl
   860  013a  7e                	ld	a, (hl)
   861  013b  23                	inc	hl
   862  013c  5e                	ld	e, (hl)
   863  013d  23                	inc	hl
   864  013e  56                	ld	d, (hl)
   865  013f  0602              	ld	b,0x02
   866                          l_esp_binary_search_bps_00103:
   867  0141  cb21              	sla	c
   868  0143  8f                	adc	a, a
   869  0144  cb13              	rl	e
   870  0146  cb12              	rl	d
   871  0148  10f7              	djnz	l_esp_binary_search_bps_00103
   872  014a  210000            	ld	hl,0x0000
   873  014d  e5                	push	hl
   874  014e  2e05              	ld	l,0x05
   875  0150  e5                	push	hl
   876  0151  d5                	push	de
   877  0152  47                	ld	b, a
   878  0153  c5                	push	bc
   879  0154  cd0000            	call	__divulong_callee
   880  0157  eb                	ex	de, hl
   881  0158  ed530a01          	ld	(_esp_prescaler_endpoint), de
   882  015c  220c01            	ld	(_esp_prescaler_endpoint + 2), hl
   883  015f  cd2400            	call	_esp_bsearch
   884  0162  eb                	ex	de, hl
   885  0163  ed531601          	ld	(_esp_binary_search_bps_uart_prescaler_lo_10000_358), de
   886  0167  221801            	ld	(_esp_binary_search_bps_uart_prescaler_lo_10000_358 + 2), hl
   887  016a  211500            	ld	hl,___str_1
   888  016d  e5                	push	hl
   889  016e  cd0000            	call	_printf
   890  0171  f1                	pop	af
   891  0172  2a0801            	ld	hl, (_esp_prescaler + 2)
   892  0175  e5                	push	hl
   893  0176  2a0601            	ld	hl, (_esp_prescaler)
   894  0179  e5                	push	hl
   895  017a  210000            	ld	hl,0x0000
   896  017d  e5                	push	hl
   897  017e  2e05              	ld	l,0x05
   898  0180  e5                	push	hl
   899  0181  cd0000            	call	__mullong_callee
   900  0184  4d                	ld	c, l
   901  0185  44                	ld	b, h
   902  0186  210a01            	ld	hl,_esp_prescaler_endpoint
   903  0189  71                	ld	(hl), c
   904  018a  23                	inc	hl
   905  018b  70                	ld	(hl), b
   906  018c  23                	inc	hl
   907  018d  73                	ld	(hl), e
   908  018e  23                	inc	hl
   909  018f  72                	ld	(hl), d
   910  0190  0602              	ld	b,0x02
   911                          l_esp_binary_search_bps_00105:
   912  0192  210d01            	ld	hl,_esp_prescaler_endpoint + 3
   913  0195  cb3e              	srl	(hl)
   914  0197  2b                	dec	hl
   915  0198  cb1e              	rr	(hl)
   916  019a  2b                	dec	hl
   917  019b  cb1e              	rr	(hl)
   918  019d  2b                	dec	hl
   919  019e  cb1e              	rr	(hl)
   920  01a0  10f0              	djnz	l_esp_binary_search_bps_00105
   921  01a2  cd2400            	call	_esp_bsearch
   922  01a5  eb                	ex	de, hl
   923  01a6  ed531a01          	ld	(_esp_binary_search_bps_uart_prescaler_hi_10000_358), de
   924  01aa  221c01            	ld	(_esp_binary_search_bps_uart_prescaler_hi_10000_358 + 2), hl
   925  01ad  3a1601            	ld	a,(_esp_binary_search_bps_uart_prescaler_lo_10000_358)
   926  01b0  211a01            	ld	hl,_esp_binary_search_bps_uart_prescaler_hi_10000_358
   927  01b3  86                	add	a, (hl)
   928  01b4  4f                	ld	c, a
   929  01b5  3a1701            	ld	a,(_esp_binary_search_bps_uart_prescaler_lo_10000_358 + 1)
   930  01b8  211b01            	ld	hl,_esp_binary_search_bps_uart_prescaler_hi_10000_358 + 1
   931  01bb  8e                	adc	a, (hl)
   932  01bc  47                	ld	b, a
   933  01bd  3a1801            	ld	a,(_esp_binary_search_bps_uart_prescaler_lo_10000_358 + 2)
   934  01c0  211c01            	ld	hl,_esp_binary_search_bps_uart_prescaler_hi_10000_358 + 2
   935  01c3  8e                	adc	a, (hl)
   936  01c4  5f                	ld	e, a
   937  01c5  3a1901            	ld	a,(_esp_binary_search_bps_uart_prescaler_lo_10000_358 + 3)
   938  01c8  211d01            	ld	hl,_esp_binary_search_bps_uart_prescaler_hi_10000_358 + 3
   939  01cb  8e                	adc	a, (hl)
   940  01cc  57                	ld	d, a
   941  01cd  cb3a              	srl	d
   942  01cf  cb1b              	rr	e
   943  01d1  cb18              	rr	b
   944  01d3  cb19              	rr	c
   945  01d5  d5                	push	de
   946  01d6  c5                	push	bc
   947  01d7  cd0000            	call	_uart_compute_prescaler
   948  01da  f1                	pop	af
   949  01db  f1                	pop	af
   950  01dc  eb                	ex	de, hl
   951  01dd  ed530000          	ld	(_esp_bps), de
   952  01e1  220200            	ld	(_esp_bps + 2), hl
   953  01e4  c9                	ret
   954                          	SECTION rodata_compiler
   955                          ___str_0:
   956  0000  2020202048696768  	DEFM "    High end        "
              20656e6420202020  
              20202020          
   957  0014  00                	DEFB 0x00
   958                          	SECTION rodata_compiler
   959                          ___str_1:
   960  0015  0a                	DEFB 0x0a
   961  0016  202020204c6f7720  	DEFM "    Low end         "
              656e642020202020  
              20202020          
   962  002a  00                	DEFB 0x00
   963                          	SECTION code_compiler
   964                          ;	---------------------------------
   965                          ; Function esp_bps_query
   966                          ; ---------------------------------
   967                          _esp_bps_query:
   968  01e5  dde5              	push	ix
   969  01e7  dd210000          	ld	ix,0
   970  01eb  dd39              	add	ix,sp
   971  01ed  21ff00            	ld	hl,0x00ff
   972  01f0  e5                	push	hl
   973  01f1  210600            	ld	hl,_buffer
   974  01f4  e5                	push	hl
   975  01f5  cd0000            	call	_uart_rx_readline_last
   976  01f8  f1                	pop	af
   977  01f9  f1                	pop	af
   978  01fa  dd6e04            	ld	l,(ix+4)
   979  01fd  dd6605            	ld	h,(ix+5)
   980  0200  cd0000            	call	_uart_tx
   981                          l_esp_bps_query_00103:
   982  0203  210600            	ld	hl,_buffer
   983  0206  3600              	ld	(hl),0x00
   984  0208  21ff00            	ld	hl,0x00ff
   985  020b  e5                	push	hl
   986  020c  210600            	ld	hl,_buffer
   987  020f  e5                	push	hl
   988  0210  cd0000            	call	_uart_rx_readline
   989  0213  f1                	pop	af
   990  0214  211e01            	ld	hl,_esp_bps_query_temp_10000_360
   991  0217  e3                	ex	(sp),hl
   992  0218  dd6e06            	ld	l,(ix+6)
   993  021b  dd6607            	ld	h,(ix+7)
   994  021e  e5                	push	hl
   995  021f  210600            	ld	hl,_buffer
   996  0222  e5                	push	hl
   997  0223  cd0000            	call	_sscanf
   998  0226  f1                	pop	af
   999  0227  f1                	pop	af
  1000  0228  f1                	pop	af
  1001  0229  7d                	ld	a, l
  1002  022a  3d                	dec	a
  1003  022b  b4                	or	a, h
  1004  022c  2019              	jr	NZ,l_esp_bps_query_00104
  1005  022e  211e01            	ld	hl,_esp_bps_query_temp_10000_360
  1006  0231  eb                	ex	de,hl
  1007  0232  210000            	ld	hl,_esp_bps
  1008  0235  1a                	ld	a, (de)
  1009  0236  77                	ld	(hl), a
  1010  0237  23                	inc	hl
  1011  0238  13                	inc	de
  1012  0239  1a                	ld	a, (de)
  1013  023a  77                	ld	(hl), a
  1014  023b  23                	inc	hl
  1015  023c  13                	inc	de
  1016  023d  1a                	ld	a, (de)
  1017  023e  77                	ld	(hl), a
  1018  023f  23                	inc	hl
  1019  0240  13                	inc	de
  1020  0241  1a                	ld	a, (de)
  1021  0242  77                	ld	(hl), a
  1022  0243  2e01              	ld	l,0x01
  1023  0245  1807              	jr	l_esp_bps_query_00106
  1024                          l_esp_bps_query_00104:
  1025  0247  3a0600            	ld	a, (_buffer + 0)
  1026  024a  b7                	or	a,a
  1027  024b  20b6              	jr	NZ,l_esp_bps_query_00103
  1028  024d  6f                	ld	l,a
  1029                          l_esp_bps_query_00106:
  1030  024e  dde1              	pop	ix
  1031  0250  c9                	ret
  1032                          ;	---------------------------------
  1033                          ; Function esp_finetune_bps
  1034                          ; ---------------------------------
  1035                          _esp_finetune_bps:
  1036  0251  212b00            	ld	hl,___str_3
  1037  0254  e5                	push	hl
  1038  0255  cd0000            	call	_puts
  1039  0258  211d00            	ld	hl,_STRING_ESP_RX_AT_BPS_R1
  1040  025b  e3                	ex	(sp),hl
  1041  025c  210e00            	ld	hl,_STRING_ESP_TX_AT_BPS_Q1
  1042  025f  e5                	push	hl
  1043  0260  cde501            	call	_esp_bps_query
  1044  0263  f1                	pop	af
  1045  0264  f1                	pop	af
  1046  0265  7d                	ld	a, l
  1047  0266  b7                	or	a, a
  1048  0267  2011              	jr	NZ,l_esp_finetune_bps_00101
  1049  0269  213600            	ld	hl,_STRING_ESP_RX_AT_BPS_R2
  1050  026c  e5                	push	hl
  1051  026d  212b00            	ld	hl,_STRING_ESP_TX_AT_BPS_Q2
  1052  0270  e5                	push	hl
  1053  0271  cde501            	call	_esp_bps_query
  1054  0274  f1                	pop	af
  1055  0275  f1                	pop	af
  1056  0276  7d                	ld	a, l
  1057  0277  b7                	or	a, a
  1058  0278  2814              	jr	Z,l_esp_finetune_bps_00102
  1059                          l_esp_finetune_bps_00101:
  1060  027a  2a0200            	ld	hl, (_esp_bps + 2)
  1061  027d  e5                	push	hl
  1062  027e  2a0000            	ld	hl, (_esp_bps)
  1063  0281  e5                	push	hl
  1064  0282  214a00            	ld	hl,___str_4
  1065  0285  e5                	push	hl
  1066  0286  cd0000            	call	_printf
  1067  0289  f1                	pop	af
  1068  028a  f1                	pop	af
  1069  028b  f1                	pop	af
  1070  028c  1815              	jr	l_esp_finetune_bps_00105
  1071                          l_esp_finetune_bps_00102:
  1072  028e  cd1801            	call	_esp_binary_search_bps
  1073  0291  2a0200            	ld	hl, (_esp_bps + 2)
  1074  0294  e5                	push	hl
  1075  0295  2a0000            	ld	hl, (_esp_bps)
  1076  0298  e5                	push	hl
  1077  0299  215c00            	ld	hl,___str_5
  1078  029c  e5                	push	hl
  1079  029d  cd0000            	call	_printf
  1080  02a0  f1                	pop	af
  1081  02a1  f1                	pop	af
  1082  02a2  f1                	pop	af
  1083                          l_esp_finetune_bps_00105:
  1084  02a3  c9                	ret
  1085                          	SECTION rodata_compiler
  1086                          ___str_3:
  1087  002b  0a                	DEFB 0x0a
  1088  002c  202046696e652074  	DEFM "  Fine tune working baud rate"
              756e6520776f726b  
              696e672062617564  
              2072617465        
  1089  0049  00                	DEFB 0x00
  1090                          	SECTION rodata_compiler
  1091                          ___str_4:
  1092  004a  2020455350207265  	DEFM "  ESP reports %lu"
              706f72747320256c  
              75                
  1093  005b  00                	DEFB 0x00
  1094                          	SECTION rodata_compiler
  1095                          ___str_5:
  1096  005c  0a                	DEFB 0x0a
  1097  005d  202042696e617279  	DEFM "  Binary search found %lu"
              2073656172636820  
              666f756e6420256c  
              75                
  1098  0076  00                	DEFB 0x00
  1099                          	SECTION code_compiler
  1100                          ;	---------------------------------
  1101                          ; Function esp_test
  1102                          ; ---------------------------------
  1103                          _esp_test:
  1104  02a4  2a0200            	ld	hl, (_esp_bps + 2)
  1105  02a7  e5                	push	hl
  1106  02a8  2a0000            	ld	hl, (_esp_bps)
  1107  02ab  e5                	push	hl
  1108  02ac  217700            	ld	hl,___str_6
  1109  02af  e5                	push	hl
  1110  02b0  cd0000            	call	_printf
  1111  02b3  f1                	pop	af
  1112  02b4  f1                	pop	af
  1113  02b5  f1                	pop	af
  1114  02b6  218300            	ld	hl,___str_7
  1115  02b9  cd0000            	call	_uart_tx
  1116  02bc  210000            	ld	hl,_STRING_ESP_TX_AT
  1117  02bf  cd0000            	call	_uart_tx
  1118  02c2  2a0200            	ld	hl, (_esp_bps + 2)
  1119  02c5  e5                	push	hl
  1120  02c6  2a0000            	ld	hl, (_esp_bps)
  1121  02c9  e5                	push	hl
  1122  02ca  210000            	ld	hl,0x0000
  1123  02cd  e5                	push	hl
  1124  02ce  21204e            	ld	hl,0x4e20
  1125  02d1  e5                	push	hl
  1126  02d2  cd0000            	call	__divulong_callee
  1127  02d5  eb                	ex	de, hl
  1128  02d6  210500            	ld	hl,0x0005
  1129  02d9  19                	add	hl, de
  1130  02da  220400            	ld	(_esp_response_time_ms), hl
  1131  02dd  c30000            	jp	_esp_response_ok
  1132                          	SECTION rodata_compiler
  1133                          ___str_6:
  1134  0077  08                	DEFB 0x08
  1135  0078  08                	DEFB 0x08
  1136  0079  08                	DEFB 0x08
  1137  007a  08                	DEFB 0x08
  1138  007b  08                	DEFB 0x08
  1139  007c  08                	DEFB 0x08
  1140  007d  08                	DEFB 0x08
  1141  007e  25376c75          	DEFM "%7lu"
  1142  0082  00                	DEFB 0x00
  1143                          	SECTION rodata_compiler
  1144                          ___str_7:
  1145  0083  0d                	DEFB 0x0d
  1146  0084  0a                	DEFB 0x0a
  1147  0085  00                	DEFB 0x00
  1148                          	SECTION code_compiler
  1149                          ;	---------------------------------
  1150                          ; Function esp_detect_bps
  1151                          ; ---------------------------------
  1152                          _esp_detect_bps:
  1153  02e0  218600            	ld	hl,___str_8
  1154  02e3  e5                	push	hl
  1155  02e4  cd0000            	call	_printf
  1156  02e7  f1                	pop	af
  1157  02e8  210300            	ld	hl,_esp_bps + 3
  1158  02eb  7e                	ld	a, (hl)
  1159  02ec  2b                	dec	hl
  1160  02ed  b6                	or	a, (hl)
  1161  02ee  2b                	dec	hl
  1162  02ef  b6                	or	a, (hl)
  1163  02f0  2b                	dec	hl
  1164  02f1  b6                	or	a, (hl)
  1165  02f2  2822              	jr	Z,l_esp_detect_bps_00104
  1166  02f4  2a0200            	ld	hl, (_esp_bps + 2)
  1167  02f7  e5                	push	hl
  1168  02f8  2a0000            	ld	hl, (_esp_bps)
  1169  02fb  e5                	push	hl
  1170  02fc  cd0000            	call	_uart_compute_prescaler
  1171  02ff  f1                	pop	af
  1172  0300  f1                	pop	af
  1173  0301  d5                	push	de
  1174  0302  e5                	push	hl
  1175  0303  cd0000            	call	_uart_set_prescaler
  1176  0306  f1                	pop	af
  1177  0307  f1                	pop	af
  1178  0308  cda402            	call	_esp_test
  1179  030b  2d                	dec	l
  1180  030c  2008              	jr	NZ,l_esp_detect_bps_00104
  1181  030e  cd5102            	call	_esp_finetune_bps
  1182  0311  2e01              	ld	l,0x01
  1183  0313  c3ff03            	jp	l_esp_detect_bps_00118
  1184                          l_esp_detect_bps_00104:
  1185  0316  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1186  0319  3600              	ld	(hl),0x00
  1187                          l_esp_detect_bps_00114:
  1188  031b  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1189  031e  6e                	ld	l, (hl)
  1190  031f  2600              	ld	h,0x00
  1191  0321  29                	add	hl, hl
  1192  0322  29                	add	hl, hl
  1193  0323  014500            	ld	bc,_common_bps
  1194  0326  09                	add	hl,bc
  1195  0327  eb                	ex	de, hl
  1196  0328  1a                	ld	a, (de)
  1197  0329  210000            	ld	hl,_esp_bps
  1198  032c  77                	ld	(hl), a
  1199  032d  13                	inc	de
  1200  032e  1a                	ld	a, (de)
  1201  032f  23                	inc	hl
  1202  0330  77                	ld	(hl), a
  1203  0331  13                	inc	de
  1204  0332  1a                	ld	a, (de)
  1205  0333  23                	inc	hl
  1206  0334  77                	ld	(hl), a
  1207  0335  13                	inc	de
  1208  0336  1a                	ld	a, (de)
  1209  0337  23                	inc	hl
  1210  0338  77                	ld	(hl), a
  1211  0339  2a0200            	ld	hl, (_esp_bps + 2)
  1212  033c  e5                	push	hl
  1213  033d  2a0000            	ld	hl, (_esp_bps)
  1214  0340  e5                	push	hl
  1215  0341  cd0000            	call	_uart_compute_prescaler
  1216  0344  f1                	pop	af
  1217  0345  f1                	pop	af
  1218  0346  d5                	push	de
  1219  0347  e5                	push	hl
  1220  0348  cd0000            	call	_uart_set_prescaler
  1221  034b  f1                	pop	af
  1222  034c  f1                	pop	af
  1223  034d  cda402            	call	_esp_test
  1224  0350  2d                	dec	l
  1225  0351  2008              	jr	NZ,l_esp_detect_bps_00115
  1226  0353  cd5102            	call	_esp_finetune_bps
  1227  0356  2e01              	ld	l,0x01
  1228  0358  c3ff03            	jp	l_esp_detect_bps_00118
  1229                          l_esp_detect_bps_00115:
  1230  035b  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1231  035e  34                	inc	(hl)
  1232  035f  7e                	ld	a, (hl)
  1233  0360  d609              	sub	a,0x09
  1234  0362  20b7              	jr	NZ,l_esp_detect_bps_00114
  1235  0364  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1236  0367  3600              	ld	(hl),0x00
  1237                          l_esp_detect_bps_00116:
  1238  0369  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1239  036c  6e                	ld	l, (hl)
  1240  036d  2600              	ld	h,0x00
  1241  036f  29                	add	hl, hl
  1242  0370  29                	add	hl, hl
  1243  0371  29                	add	hl, hl
  1244  0372  016900            	ld	bc,_common_bps_range
  1245  0375  09                	add	hl,bc
  1246  0376  eb                	ex	de, hl
  1247  0377  13                	inc	de
  1248  0378  13                	inc	de
  1249  0379  13                	inc	de
  1250  037a  13                	inc	de
  1251  037b  1a                	ld	a, (de)
  1252  037c  210000            	ld	hl,_esp_bps
  1253  037f  77                	ld	(hl), a
  1254  0380  13                	inc	de
  1255  0381  1a                	ld	a, (de)
  1256  0382  23                	inc	hl
  1257  0383  77                	ld	(hl), a
  1258  0384  13                	inc	de
  1259  0385  1a                	ld	a, (de)
  1260  0386  23                	inc	hl
  1261  0387  77                	ld	(hl), a
  1262  0388  13                	inc	de
  1263  0389  1a                	ld	a, (de)
  1264  038a  23                	inc	hl
  1265  038b  77                	ld	(hl), a
  1266                          l_esp_detect_bps_00110:
  1267  038c  2a0200            	ld	hl, (_esp_bps + 2)
  1268  038f  e5                	push	hl
  1269  0390  2a0000            	ld	hl, (_esp_bps)
  1270  0393  e5                	push	hl
  1271  0394  cd0000            	call	_uart_compute_prescaler
  1272  0397  f1                	pop	af
  1273  0398  f1                	pop	af
  1274  0399  d5                	push	de
  1275  039a  e5                	push	hl
  1276  039b  cd0000            	call	_uart_set_prescaler
  1277  039e  f1                	pop	af
  1278  039f  f1                	pop	af
  1279  03a0  cda402            	call	_esp_test
  1280  03a3  2d                	dec	l
  1281  03a4  2007              	jr	NZ,l_esp_detect_bps_00109
  1282  03a6  cd5102            	call	_esp_finetune_bps
  1283  03a9  2e01              	ld	l,0x01
  1284  03ab  1852              	jr	l_esp_detect_bps_00118
  1285                          l_esp_detect_bps_00109:
  1286  03ad  2a0200            	ld	hl, (_esp_bps + 2)
  1287  03b0  e5                	push	hl
  1288  03b1  2a0000            	ld	hl, (_esp_bps)
  1289  03b4  e5                	push	hl
  1290  03b5  210000            	ld	hl,0x0000
  1291  03b8  e5                	push	hl
  1292  03b9  2e50              	ld	l,0x50
  1293  03bb  e5                	push	hl
  1294  03bc  cd0000            	call	__mullong_callee
  1295  03bf  010000            	ld	bc,0x0000
  1296  03c2  c5                	push	bc
  1297  03c3  0e51              	ld	c,0x51
  1298  03c5  c5                	push	bc
  1299  03c6  d5                	push	de
  1300  03c7  e5                	push	hl
  1301  03c8  cd0000            	call	__divulong_callee
  1302  03cb  eb                	ex	de, hl
  1303  03cc  ed530000          	ld	(_esp_bps), de
  1304  03d0  220200            	ld	(_esp_bps + 2), hl
  1305  03d3  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1306  03d6  6e                	ld	l, (hl)
  1307  03d7  2600              	ld	h,0x00
  1308  03d9  29                	add	hl, hl
  1309  03da  29                	add	hl, hl
  1310  03db  29                	add	hl, hl
  1311  03dc  116900            	ld	de,_common_bps_range
  1312  03df  19                	add	hl, de
  1313  03e0  4e                	ld	c, (hl)
  1314  03e1  23                	inc	hl
  1315  03e2  46                	ld	b, (hl)
  1316  03e3  23                	inc	hl
  1317  03e4  5e                	ld	e, (hl)
  1318  03e5  23                	inc	hl
  1319  03e6  56                	ld	d, (hl)
  1320  03e7  2a0000            	ld	hl, (_esp_bps)
  1321  03ea  bf                	cp	a, a
  1322  03eb  ed42              	sbc	hl, bc
  1323  03ed  2a0200            	ld	hl, (_esp_bps + 2)
  1324  03f0  ed52              	sbc	hl, de
  1325  03f2  3098              	jr	NC,l_esp_detect_bps_00110
  1326  03f4  212601            	ld	hl,_esp_detect_bps_i_10000_370
  1327  03f7  34                	inc	(hl)
  1328  03f8  7e                	ld	a, (hl)
  1329  03f9  d604              	sub	a,0x04
  1330  03fb  c26903            	jp	NZ,l_esp_detect_bps_00116
  1331  03fe  6f                	ld	l,a
  1332                          l_esp_detect_bps_00118:
  1333  03ff  c9                	ret
  1334                          	SECTION rodata_compiler
  1335                          ___str_8:
  1336  0086  2020547279696e67  	DEFM "  Trying        "
              2020202020202020  
  1337  0096  00                	DEFB 0x00
  1338                          	SECTION data_compiler
  1339                          _STRING_ESP_TX_AT:
  1340  0000  4154              	DEFM "AT"
  1341  0002  0d                	DEFB 0x0d
  1342  0003  0a                	DEFB 0x0a
  1343  0004  00                	DEFB 0x00
  1344                          _STRING_ESP_TX_AT_GMR:
  1345  0005  41542b474d52      	DEFM "AT+GMR"
  1346  000b  0d                	DEFB 0x0d
  1347  000c  0a                	DEFB 0x0a
  1348  000d  00                	DEFB 0x00
  1349                          _STRING_ESP_TX_AT_BPS_Q1:
  1350  000e  41542b554152545f  	DEFM "AT+UART_CUR?"
              4355523f          
  1351  001a  0d                	DEFB 0x0d
  1352  001b  0a                	DEFB 0x0a
  1353  001c  00                	DEFB 0x00
  1354                          _STRING_ESP_RX_AT_BPS_R1:
  1355  001d  2b554152545f4355  	DEFM "+UART_CUR:%lu"
              523a256c75        
  1356  002a  00                	DEFB 0x00
  1357                          _STRING_ESP_TX_AT_BPS_Q2:
  1358  002b  41542b554152543f  	DEFM "AT+UART?"
  1359  0033  0d                	DEFB 0x0d
  1360  0034  0a                	DEFB 0x0a
  1361  0035  00                	DEFB 0x00
  1362                          _STRING_ESP_RX_AT_BPS_R2:
  1363  0036  2b554152543a256c  	DEFM "+UART:%lu"
              75                
  1364  003f  00                	DEFB 0x00
  1365                          _STRING_ESP_RX_OK:
  1366  0040  4f4b              	DEFM "OK"
  1367  0042  0d                	DEFB 0x0d
  1368  0043  0a                	DEFB 0x0a
  1369  0044  00                	DEFB 0x00
  1370                          _common_bps:
  1371  0045  00c20100          	DEFB +0x00,0xc2, +0x01, +0x00
  1372  0049  80250000          	DEFB +0x80,0x25, +0x00, +0x00
  1373  004d  80841e00          	DEFB +0x80,0x84, +0x1e, +0x00
  1374  0051  40420f00          	DEFB +0x40,0x42, +0x0f, +0x00
  1375  0055  00941100          	DEFB +0x00,0x94, +0x11, +0x00
  1376  0059  00e10000          	DEFB +0x00,0xe1, +0x00, +0x00
  1377  005d  004b0000          	DEFB +0x00,0x4b, +0x00, +0x00
  1378  0061  127a0000          	DEFB +0x12,0x7a, +0x00, +0x00
  1379  0065  80240100          	DEFB +0x80,0x24, +0x01, +0x00
  1380                          _common_bps_range:
  1381  0069  40420f00          	DEFB +0x40,0x42, +0x0f, +0x00
  1382  006d  80841e00          	DEFB +0x80,0x84, +0x1e, +0x00
  1383  0071  00c20100          	DEFB +0x00,0xc2, +0x01, +0x00
  1384  0075  40420f00          	DEFB +0x40,0x42, +0x0f, +0x00
  1385  0079  2c010000          	DEFB +0x2c,0x01, +0x00, +0x00
  1386  007d  004b0000          	DEFB +0x00,0x4b, +0x00, +0x00
  1387  0081  004b0000          	DEFB +0x00,0x4b, +0x00, +0x00
  1388  0085  00c20100          	DEFB +0x00,0xc2, +0x01, +0x00
  1389                          	SECTION IGNORE
  1390                          
